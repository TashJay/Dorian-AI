<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>D.O.R.I.A.N - AI Legal Assistant</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
<style>
body {
font-family: 'Inter', sans-serif;
/* Deeper, more futuristic dark background with a subtle radial gradient */
background: radial-gradient(circle at top left, #1a2a3a 0%, #0d1a2a 50%, #000000 100%);
background-color: #000000; /* Fallback */
}
.chat-bubble {
max-width: 80%;
padding: 14px 20px; /* Slightly more padding */
border-radius: 20px; /* More rounded corners */
word-wrap: break-word;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* Subtle shadow for depth */
}
.chat-bubble-user {
background-color: #e0f2fe; /* Light blue for user */
color: #1a202c; /* Darker text */
border-bottom-right-radius: 8px; /* Softer edge */
}
.chat-bubble-ai {
background-color: #2c3e50; /* Deep blue-gray for AI */
color: #e0f2fe; /* Light blue text */
border-bottom-left-radius: 8px; /* Softer edge */
}
.chat-bubble-system {
font-style: italic;
text-align: center;
width: 100%;
max-width: 100%;
background-color: #1a2a3a; /* Darker background for system messages */
color: #90aec1; /* Muted, professional system message color */
border-radius: 12px;
padding: 8px 16px;
box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
}
.onboarding-step {
transition: opacity 0.6s ease-in-out, transform 0.6s ease-in-out;
}
.hidden-step {
opacity: 0;
transform: translateY(30px); /* More pronounced hide animation */
position: absolute;
pointer-events: none;
}
/* Removed talking animation as Lottie will handle it */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: #1a2a3a; /* Darker scrollbar track */ }
::-webkit-scrollbar-thumb { background: #4a6d8c; border-radius: 4px; /* More professional thumb color */ }
::-webkit-scrollbar-thumb:hover { background: #5a8bbd; }

/* Custom styles for professional glow/shadow */
.professional-glow-shadow {
box-shadow: 0 0 15px rgba(0, 188, 212, 0.3), 0 0 30px rgba(0, 188, 212, 0.1); /* Teal glow */
}
.input-focus-ring-blue {
border-color: #3f83f8;
box-shadow: 0 0 0 3px rgba(63, 131, 248, 0.5); /* Blue focus ring */
}
</style>
</head>
<body class="text-white">

<div id="app-container" class="w-full h-screen max-w-7xl mx-auto flex flex-col">

<div id="onboarding-modal" class="absolute inset-0 bg-black bg-opacity-95 z-50 flex items-center justify-center p-4">
<div class="relative max-w-lg w-full">
<div id="onboarding-step-1" class="onboarding-step text-center p-8 bg-gray-900 rounded-3xl shadow-2xl professional-glow-shadow">
<div class="w-full h-40 bg-gradient-to-br from-blue-900 to-gray-800 rounded-xl mb-6 overflow-hidden flex items-center justify-center">
<img src="https://placehold.co/600x300/0d1a2a/e0f2fe?text=D.O.R.I.A.N." alt="DORIAN Placeholder" class="w-full h-full object-cover opacity-80">
</div>
<h1 class="text-5xl md:text-6xl font-extrabold text-white mb-4 tracking-tight">D.O.R.I.A.N.</h1>
<p class="text-xl text-blue-200 mb-2 font-light">Your AI-Powered Legal Information Assistant</p>
<p class="text-sm text-gray-400 mb-6 font-thin">by Jay Irungu</p>
<button onclick="nextOnboardingStep(1)" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full transition-all duration-300 hover:bg-blue-600 hover:shadow-lg w-full text-lg">Begin Your Legal Journey</button>
</div>

<div id="onboarding-step-2" class="onboarding-step hidden-step text-center p-8 bg-gray-900 rounded-3xl shadow-2xl professional-glow-shadow">
<h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Set Your Jurisdiction</h2>
<p class="text-gray-300 mb-6 text-lg">To provide the most relevant legal insights, please specify the country or region of law you're interested in.</p>
<input type="text" id="country-input" placeholder="e.g., Canada, European Union, Kenya" class="w-full bg-gray-800 text-white p-4 rounded-xl mb-6 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 input-focus-ring-blue placeholder-gray-500">
<button onclick="nextOnboardingStep(2)" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full transition-all duration-300 hover:bg-blue-600 hover:shadow-lg w-full text-lg">Proceed</button>
</div>

<div id="onboarding-step-3" class="onboarding-step hidden-step text-center p-8 bg-gray-900 rounded-3xl shadow-2xl professional-glow-shadow">
<h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Important Disclaimer</h2>
<p class="text-md text-blue-300 mb-6 p-4 bg-gray-800 rounded-lg border border-blue-700 leading-relaxed">
Please remember, D.O.R.I.A.N. is an advanced AI assistant designed to provide general legal information for educational and informational purposes only. It is <strong class="text-red-400">not a substitute for professional legal advice</strong> from a qualified attorney. Always consult with a legal professional for advice tailored to your specific situation.
</p>
<button onclick="finishOnboarding()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full transition-all duration-300 hover:shadow-lg w-full text-lg">I Understand & Begin</button>
</div>
</div>
</div>

<div id="app-screen" class="hidden w-full h-full flex flex-col md:flex-row p-2 md:p-6 gap-4">
<div class="w-full md:w-1/3 lg:w-1/4 bg-gray-900 rounded-3xl p-6 flex flex-col items-center justify-between shadow-2xl professional-glow-shadow">
<div class="w-full text-center">
<h2 class="text-4xl font-extrabold text-blue-400 mb-6">D.O.R.I.A.N.</h2>
<div id="lottie-avatar-container" class="relative w-48 h-48 md:w-56 md:h-56 mx-auto my-6 bg-gradient-to-br from-blue-800 to-gray-800 rounded-full flex items-center justify-center overflow-hidden border-4 border-blue-500 shadow-xl">
</div>
<p class="text-gray-400 text-lg">Status: <span id="status-text" class="text-green-500 font-bold tracking-wide">Ready</span></p>
</div>
<div class="w-full mt-8">
<p class="text-sm text-gray-500 text-center">Version 1.0.0</p>
</div>
</div>

<div class="w-full md:w-2/3 lg:w-3/4 bg-gray-900 rounded-3xl flex flex-col shadow-2xl professional-glow-shadow">
<div class="p-5 border-b border-gray-700 flex items-center justify-between bg-gray-800 rounded-t-3xl">
<h2 class="text-2xl font-bold text-white">Legal Chat Assistant</h2>
<div class="flex items-center gap-3">
<p class="text-md text-gray-400">Jurisdiction: <span id="jurisdiction-display" class="font-bold text-blue-300"></span></p>
<button id="change-jurisdiction-btn" class="text-sm bg-blue-700 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-full transition-colors duration-200">Change Jurisdiction</button>
</div>
</div>

<div id="chat-log" class="flex-1 p-4 overflow-y-auto space-y-5"></div>

<div class="p-4 border-t border-gray-700 bg-gray-800 rounded-b-3xl">
<form id="chat-form" class="flex items-center gap-4">
<textarea id="chat-input" class="flex-1 bg-gray-700 text-gray-100 rounded-xl p-3 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 border border-gray-600 placeholder-gray-400 text-lg" placeholder="Ask a legal question..." rows="1" required></textarea>
<button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg">
<svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path></svg>
</button>
</form>
</div>
</div>
</div>

<div id="error-modal" class="hidden absolute inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4">
<div class="bg-gray-800 border border-red-600 rounded-xl p-8 text-center shadow-xl max-w-sm professional-glow-shadow">
<h3 class="text-2xl font-bold text-red-500 mb-3">System Error!</h3>
<p id="error-message" class="text-gray-300 mb-6 text-md leading-relaxed"></p>
<button onclick="document.getElementById('error-modal').classList.add('hidden')" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-200">Close</button>
</div>
</div>
</div>

<script type="module">
// --- START OF CHANGES ---
// 1. Inserted the new Gemini API Key
const geminiApiKey = "AIzaSyBTjCw0E5fJwFdDxP1sJvxBnPygEU3Npkw";

// Lottie animation instance
let lottieAnimation = null;
const lottieAvatarContainer = document.getElementById('lottie-avatar-container');
// --- END OF CHANGES ---

const onboardingModal = document.getElementById('onboarding-modal');
const appScreen = document.getElementById('app-screen');
const chatForm = document.getElementById('chat-form');
const chatInput = document.getElementById('chat-input');
const chatLog = document.getElementById('chat-log');
const statusText = document.getElementById('status-text');
// Removed avatarMouth as Lottie will handle animation
const errorModal = document.getElementById('error-modal');
const errorMessage = document.getElementById('error-message');
const countryInput = document.getElementById('country-input');
const jurisdictionDisplay = document.getElementById('jurisdiction-display');
const changeJurisdictionBtn = document.getElementById('change-jurisdiction-btn');

let chatHistory = [];
let currentJurisdiction = "General";

window.nextOnboardingStep = (step) => {
const currentStepDiv = document.getElementById(`onboarding-step-${step}`);
const nextStepDiv = document.getElementById(`onboarding-step-${step + 1}`);

if (step === 2) {
const country = countryInput.value.trim();
if (!country) {
alert("Please enter a country to set your jurisdiction.");
return;
}
currentJurisdiction = country;
jurisdictionDisplay.textContent = currentJurisdiction;
}

currentStepDiv.classList.add('hidden-step');
// Add a small delay for the transition to be visible before removing 'hidden-step'
setTimeout(() => {
currentStepDiv.classList.add('hidden'); // Fully hide after transition
nextStepDiv.classList.remove('hidden-step');
nextStepDiv.classList.remove('hidden'); // Ensure next step is visible
}, 500); // Match this with your transition duration
};

window.finishOnboarding = () => {
onboardingModal.style.opacity = '0';
setTimeout(() => {
onboardingModal.classList.add('hidden');
appScreen.classList.remove('hidden');
addMessageToLog('system', `Jurisdiction set to ${currentJurisdiction}. You can now ask questions.`);

// Initialize Lottie animation once app screen is visible
lottieAnimation = lottie.loadAnimation({
container: lottieAvatarContainer, // the DOM element that will contain the animation
renderer: 'svg',
loop: true, // Set to true if your talking animation should loop naturally
autoplay: false, // Start paused, play when speaking
// Direct embedding of the Lottie JSON data
animationData: {"v":"4.8.0","meta":{"g":"LottieFiles AE ","a":"","k":"","d":"","tc":""},"fr":30,"ip":0,"op":120,"w":800,"h":600,"nm":"Man 02","ddd":0,"assets":[],"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"Hair Front","parent":6,"sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[2.441,-64.762,0],"ix":2},"a":{"a":0,"k":[402.169,141.633,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-47.097,36.344],[7.576,4.775],[0,0],[26.292,0.649],[0,0],[2.854,3.526],[11.576,-11.777],[8.451,-30.599]],"o":[[0,0],[31.91,-24.624],[-16.557,-10.436],[0,0],[-15.536,-0.383],[0,0],[-10.451,-12.91],[-20.8,21.16],[-5.78,20.928]],"v":[[-56.665,38.759],[58,24.825],[80.191,-29.796],[54.323,-19.927],[37.109,-45.209],[15.215,-30.419],[11.138,-37.041],[-28.28,-35.495],[-84.253,10.151]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"fl","c":{"a":0,"k":[0.337254911661,0.235294118524,0,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[352.234,125.069],"ix":2},"a":{"a":0,"k":[-56.491,9.937],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":92,"s":[0]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":96,"s":[-3]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":101,"s":[1]},{"t":103,"s":[0]}],"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 1","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[26.848,13.791],[0,0],[-22.398,-19.615]],"o":[[0,0],[-26.848,-13.791],[0,0],[5.765,-0.108]],"v":[[20.902,46.501],[9.621,-42.684],[-25.39,-28.46],[12.443,45.224]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"fl","c":{"a":0,"k":[0.337254911661,0.235294118524,0,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[469.583,167.225],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 2","np":2,"cix":2,"bm":0,"ix":2,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-23.399,12.036],[0,0],[14.013,1.008]],"o":[[0,0],[23.399,-12.036],[0,0],[-1.38,0]],"v":[[-16.315,45.575],[-7.021,-42.418],[20.53,-28.194],[-13.485,45.381]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"fl","c":{"a":0,"k":[0.337254911661,0.235294118524,0,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[329.895,166.958],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 3","np":2,"cix":2,"bm":0,"ix":3,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":180,"st":0,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"Brown Eyes","parent":6,"sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[-1.076,-13.462,0],"ix":2},"a":{"a":0,"k":[398.652,192.933,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[2.554,0],[0,0],[0,2.554],[0,0],[-2.554,0],[0,0],[0,-2.554],[0,0]],"o":[[0,0],[-2.554,0],[0,0],[0,-2.554],[0,0],[2.554,0],[0,0],[0,2.554]],"v":[[8.357,4.624],[-8.357,4.624],[-12.98,0],[-12.98,0],[-8.357,-4.624],[8.357,-4.624],[12.98,0],[12.98,0]],"c":true},"ix":2},"nm":"Path 1","